/**
 * Accessibility Utilities
 * WCAG AA compliant styles for keyboard navigation, focus indicators, and screen readers
 */

/* Skip Links - Allow keyboard users to skip to main content */
@layer components {
  .skip-link {
    position: absolute;
    top: -40px;
    left: 0;
    background: hsl(var(--primary));
    color: hsl(var(--primary-foreground));
    padding: 8px 16px;
    text-decoration: none;
    z-index: 100;
    border-radius: 0 0 4px 0;
    font-weight: 600;
    transition: top 200ms cubic-bezier(0.4, 0, 0.2, 1);
  }

  .skip-link:focus {
    top: 0;
    outline: 2px solid hsl(var(--ring));
    outline-offset: 2px;
  }
}

/* Focus Indicators - Enhanced focus styles for keyboard navigation */
@layer utilities {
  /* Base focus-visible style - only shows on keyboard navigation */
  .focus-visible-ring:focus-visible {
    outline: 2px solid hsl(var(--ring));
    outline-offset: 2px;
    border-radius: 4px;
  }

  /* Enhanced focus ring for buttons */
  .btn-focus:focus-visible {
    outline: 2px solid hsl(var(--ring));
    outline-offset: 2px;
    box-shadow: 0 0 0 4px hsl(var(--ring) / 0.1);
  }

  /* Enhanced focus ring for inputs */
  .input-focus:focus-visible {
    outline: 2px solid hsl(var(--ring));
    outline-offset: 0;
    border-color: hsl(var(--ring));
    box-shadow: 0 0 0 3px hsl(var(--ring) / 0.1);
  }

  /* Enhanced focus ring for links */
  .link-focus:focus-visible {
    outline: 2px solid hsl(var(--ring));
    outline-offset: 4px;
    border-radius: 2px;
  }

  /* Focus ring for cards */
  .card-focus:focus-visible {
    outline: 2px solid hsl(var(--ring));
    outline-offset: 2px;
    box-shadow: 0 0 0 4px hsl(var(--ring) / 0.1);
  }
}

/* Screen Reader Only - Hide visually but keep accessible to screen readers */
@layer utilities {
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
  }

  .sr-only-focusable:focus {
    position: static;
    width: auto;
    height: auto;
    padding: inherit;
    margin: inherit;
    overflow: visible;
    clip: auto;
    white-space: normal;
  }

  /* Not screen reader only - opposite of sr-only */
  .not-sr-only {
    position: static;
    width: auto;
    height: auto;
    padding: 0;
    margin: 0;
    overflow: visible;
    clip: auto;
    white-space: normal;
  }
}

/* ARIA Live Regions - For dynamic content updates */
@layer components {
  .aria-live-polite {
    position: absolute;
    left: -10000px;
    width: 1px;
    height: 1px;
    overflow: hidden;
  }

  .aria-live-assertive {
    position: absolute;
    left: -10000px;
    width: 1px;
    height: 1px;
    overflow: hidden;
  }
}

/* High Contrast Mode Support */
@media (prefers-contrast: high) {
  :root {
    --ring: 220 100% 50%;
  }

  .focus-visible-ring:focus-visible,
  .btn-focus:focus-visible,
  .input-focus:focus-visible,
  .link-focus:focus-visible,
  .card-focus:focus-visible {
    outline-width: 3px;
    outline-offset: 3px;
  }

  button,
  a,
  input,
  select,
  textarea {
    border-width: 2px;
  }
}

/* Reduced Motion - Respect user's motion preferences */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }

  .skip-link {
    transition: none;
  }
}

/* Keyboard Navigation Indicators */
@layer utilities {
  /* Show focus indicator only on keyboard navigation, not mouse clicks */
  .keyboard-focus:focus:not(:focus-visible) {
    outline: none;
  }

  .keyboard-focus:focus-visible {
    outline: 2px solid hsl(var(--ring));
    outline-offset: 2px;
  }
}

/* Color Contrast Utilities - WCAG AA compliant */
@layer utilities {
  /* Ensure minimum 4.5:1 contrast for normal text */
  .text-contrast {
    color: hsl(var(--foreground));
  }

  /* Ensure minimum 3:1 contrast for large text (18pt+) */
  .text-large-contrast {
    color: hsl(var(--foreground));
    font-size: 1.125rem; /* 18px */
    font-weight: 600;
  }

  /* High contrast text for critical information */
  .text-high-contrast {
    color: hsl(var(--foreground));
    font-weight: 600;
  }
}

/* Form Accessibility */
@layer components {
  /* Required field indicator */
  .required-indicator::after {
    content: " *";
    color: hsl(var(--destructive));
    font-weight: 600;
    margin-left: 2px;
  }

  /* Error message styling */
  .error-message {
    color: hsl(var(--destructive));
    font-size: 0.875rem;
    margin-top: 4px;
    display: flex;
    align-items: center;
    gap: 4px;
  }

  /* Success message styling */
  .success-message {
    color: hsl(142 76% 36%);
    font-size: 0.875rem;
    margin-top: 4px;
    display: flex;
    align-items: center;
    gap: 4px;
  }

  /* Invalid input styling */
  .input-invalid {
    border-color: hsl(var(--destructive));
    background-color: hsl(var(--destructive) / 0.05);
  }

  .input-invalid:focus {
    outline-color: hsl(var(--destructive));
    box-shadow: 0 0 0 3px hsl(var(--destructive) / 0.1);
  }

  /* Valid input styling */
  .input-valid {
    border-color: hsl(142 76% 36%);
    background-color: hsl(142 76% 36% / 0.05);
  }

  .input-valid:focus {
    outline-color: hsl(142 76% 36%);
    box-shadow: 0 0 0 3px hsl(142 76% 36% / 0.1);
  }
}

/* Dialog/Modal Accessibility */
@layer components {
  /* Focus trap - prevent focus from leaving modal */
  .dialog-focus-trap {
    position: fixed;
    inset: 0;
    z-index: 50;
  }

  /* Modal overlay */
  .dialog-overlay {
    position: fixed;
    inset: 0;
    background-color: hsl(0 0% 0% / 0.5);
    z-index: 50;
  }

  /* Modal content */
  .dialog-content {
    position: fixed;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    z-index: 51;
    max-height: 90vh;
    overflow-y: auto;
  }

  /* Ensure first focusable element gets focus */
  .dialog-content:focus {
    outline: none;
  }
}

/* Table Accessibility */
@layer components {
  /* Table caption for screen readers */
  .table-caption {
    caption-side: top;
    text-align: left;
    font-weight: 600;
    padding: 8px;
    color: hsl(var(--foreground));
  }

  /* Sortable table headers */
  .table-header-sortable {
    cursor: pointer;
    user-select: none;
  }

  .table-header-sortable:hover {
    background-color: hsl(var(--muted));
  }

  .table-header-sortable:focus-visible {
    outline: 2px solid hsl(var(--ring));
    outline-offset: -2px;
  }

  /* Table row hover state */
  .table-row-interactive {
    cursor: pointer;
    transition: background-color 200ms cubic-bezier(0.4, 0, 0.2, 1);
  }

  .table-row-interactive:hover {
    background-color: hsl(var(--muted) / 0.5);
  }

  .table-row-interactive:focus-visible {
    outline: 2px solid hsl(var(--ring));
    outline-offset: -2px;
  }
}

/* Navigation Accessibility */
@layer components {
  /* Navigation landmark */
  nav[aria-label] {
    /* Ensure nav has proper ARIA label */
  }

  /* Current page indicator */
  .nav-current {
    font-weight: 600;
    position: relative;
  }

  .nav-current::before {
    content: "";
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 3px;
    background-color: hsl(var(--primary));
  }

  /* Breadcrumb navigation */
  .breadcrumb {
    display: flex;
    align-items: center;
    gap: 8px;
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .breadcrumb-item {
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .breadcrumb-separator {
    color: hsl(var(--muted-foreground));
  }
}

/* Tooltip Accessibility */
@layer components {
  /* Tooltip should be keyboard accessible */
  .tooltip-trigger:focus-visible + .tooltip {
    opacity: 1;
    visibility: visible;
  }

  .tooltip {
    position: absolute;
    z-index: 50;
    padding: 4px 8px;
    background-color: hsl(var(--popover));
    color: hsl(var(--popover-foreground));
    border: 1px solid hsl(var(--border));
    border-radius: 4px;
    font-size: 0.875rem;
    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
  }
}

/* Status Indicators - Ensure color is not the only indicator */
@layer components {
  /* Success status */
  .status-success {
    color: hsl(142 76% 36%);
  }

  .status-success::before {
    content: "✓ ";
    font-weight: 600;
  }

  /* Error status */
  .status-error {
    color: hsl(var(--destructive));
  }

  .status-error::before {
    content: "✗ ";
    font-weight: 600;
  }

  /* Warning status */
  .status-warning {
    color: hsl(38 92% 50%);
  }

  .status-warning::before {
    content: "⚠ ";
    font-weight: 600;
  }

  /* Info status */
  .status-info {
    color: hsl(221 83% 53%);
  }

  .status-info::before {
    content: "ℹ ";
    font-weight: 600;
  }
}

/* Print Styles - Ensure accessibility in print */
@media print {
  .skip-link,
  .sr-only {
    display: none;
  }

  a[href]::after {
    content: " (" attr(href) ")";
    font-size: 0.875rem;
    color: hsl(var(--muted-foreground));
  }

  /* Ensure focus indicators don't appear in print */
  *:focus,
  *:focus-visible {
    outline: none !important;
    box-shadow: none !important;
  }
}
